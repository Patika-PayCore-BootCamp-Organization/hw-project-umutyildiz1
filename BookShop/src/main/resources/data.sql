DROP TABLE IF EXISTS Customer CASCADE;
DROP TABLE IF EXISTS Book CASCADE;
DROP TABLE IF EXISTS Cart CASCADE;
DROP TABLE IF EXISTS Cart_Book CASCADE;
DROP TABLE IF EXISTS Category CASCADE;

CREATE TABLE Customer
(

    id      INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    customer_name    VARCHAR(50) NOT NULL,
    surname VARCHAR(50) NOT NULL,
    age     INT DEFAULT 0,
    email   VARCHAR(50) UNIQUE NOT NULL

);

CREATE TABLE Book
(
    isbn INT PRIMARY KEY,
    author_name VARCHAR(255),
    title VARCHAR(255) NOT NULL,
    price INT DEFAULT 0 NOT NULL,
    customer_id INT NOT NULL,
    category_id INT NOT NULL

);

CREATE TABLE Cart
(
    id INT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    customer_id INT NOT NULL
);

CREATE TABLE Cart_Book
(
    cart_id INT NOT NULL,
    isbn INT NOT NULL,
    PRIMARY KEY(cart_id,ISBN)
);

CREATE TABLE Category
(
    id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    category_name VARCHAR(255) NOT NULL
);

-- FOREIGN KEY CONSTRAINTS

ALTER TABLE Book
ADD CONSTRAINT fk_book_customer FOREIGN KEY (customer_id) REFERENCES Customer(id);
ALTER TABLE Book
ADD CONSTRAINT fk_book_category FOREIGN KEY (category_id) REFERENCES Category(id);

ALTER TABLE Cart
ADD CONSTRAINT fk_cart_user FOREIGN KEY (customer_id) REFERENCES Customer(id);

ALTER TABLE Cart_Book
ADD CONSTRAINT fk_cart_book_cart FOREIGN KEY (cart_id) REFERENCES Cart(id) ON DELETE CASCADE;
ALTER TABLE Cart_Book
ADD CONSTRAINT fk_cart_book_book FOREIGN KEY (ISBN) REFERENCES Book(isbn)  ON DELETE CASCADE;

-- FAKE DATA INSERTION
INSERT INTO Customer(customer_name, surname, age, email)
VALUES ('Ali','YILMAZ',18,'ali.yilmaz@gmail.com'),
       ('Veli','YILDIZ',27,'veli.yildiz@gmail.com'),
       ('Ayşe','SAYGIN',19,'ayse.saygin@gmail.com'),
       ('Fatma','ÖZ',35,'fatma.oz@gmail.com');
INSERT INTO Category(category_name)
VALUES ('Kişisel Gelişim'),
       ('Polisiye'),
       ('Çocuk'),
       ('Bilim Kurgu'),
       ('Aşk');

INSERT INTO Book(isbn, author_name, title, price, customer_id, category_id)
VALUES (1,'İlber ORTAYLI','Bir Ömür Nasıl Yaşanır?',30,1,1),
       (2,'John VERDON','Aklından Bir Sayı Tut',45,2,2),
       (3,'Elif Şafak','Aşk',20,3,5),
       (4,'James Dashner','Labirent Virüs Kodu',60,4,4);

INSERT INTO Cart(customer_id)
VALUES (1),
       (2),
       (3),
       (4);
INSERT INTO Cart_Book(cart_id, isbn)
VALUES (1,2),
       (1,3),
       (2,1),
       (3,4),
       (4,1);
